---
title: "Exploratory Analysis"
output: 
  html_document:
    toc: true                
    toc_float: true        
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(dplyr)
```


```{r, message=FALSE}
final=
read_csv("./Data/final_avg.csv") 
```

On this page, we will explore overall trends for our exposure, people wearing masks, and our outcomes, confirmed Influenza admissions per day (7-day average) and Flu-like symptoms in the past 7 days (weighted), across states in the U.S.

##Data Description
```{r, message=FALSE} 
merged%>%
  select(admission, maskwearing, symptom)%>%
  summary()%>%
  knitr::kable(digits = 3)

```
Our data has `r nrow(merged)` observations and `r ncol(merged)` variables and tells us about maskwearing, influenza symptoms, and admissions across the U.S. from years `r range(merged$date)[1]` to `r range(merged$date)[2]`. The average percentage of people who say they wear a mask most or all of the time when they are in public in the past 7 days is 52.87%. The average number of adult and pediatric hospital admissions with confirmed influenza occurring each day (7-day average) is 131.54, and the average percentage of people self-reporting influenza-like symptoms such as fever with cough or sore throat in the past 7 days is 1.81%. 

###Trends for People Wearing Masks

####Overall Trends in the U.S. 2021-2022
```{r}
merged%>%
  drop_na%>%
  group_by(date)%>%
  summarize(avg_maskwearing=mean(as.numeric(maskwearing)))%>%
  ggplot(aes(x = date, y = avg_maskwearing)) +
  geom_line()+
  labs(title = "Average Percentage of People Wearing Masks", x = "Date", y = "Percentage of People Wearing Masks")+
  theme(plot.title=element_text(face="bold", color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))
```
From this graph, we can see that the average percentage of people wearing masks sharply decreased by the end of May and steadily climbed up by the end of 2021. Then after percentage of people wearing masks peaked on February in 2022, it began to decline again by March.

####Overall Trend by State
```{r}
merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  drop_na%>%
  group_by(state)%>%
   mutate(avg_maskwearing = mean(as.numeric(maskwearing))) %>% 
   ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_maskwearing)
  ) %>% 
 plot_ly(
      y = ~avg_maskwearing, x = ~state, color = ~state,
      type = "bar", colors = "viridis") %>% 
  layout(
    xaxis = list(title = "State"),
    yaxis = list(title = "Percentage of People Wearing Mask")
)

merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  group_by(state)%>%
  drop_na%>%
  mutate(avg_maskwearing = mean(as.numeric(maskwearing))) %>% 
  ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_maskwearing)
  ) %>% 
 ggplot(aes(x = state, y = avg_maskwearing)) +
  geom_point() +
  labs(title = "Average Percentage of People Wearing Masks", x = "State", y = "Percentage of People Wearing Masks")+
  theme(plot.title=element_text(face="bold", color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))
```
The five states with the highest percentage of people wearing masks are Hawaii, California, District of Columbia, Washington, and New Mexico. The states with the lowest percentage of people wearing masks are North Dakota, South Dakota, Wyoming, Montana, and Idaho.



###Trends for Confirmed Influenza Admissions per Day (7-day average)
```{r}
merged%>%
  drop_na%>%
  group_by(date)%>%
  summarize(avg_admission=mean(as.numeric(admission)))%>%
  ggplot(aes(x = date, y = avg_admission)) +
  geom_line()+
  labs(title = "Average Number of Hospital Admissions with Confirmed Influenza", x = "Date", y = "Number of Hospital Admissions")+
   theme(plot.title=element_text(face="bold", size=12, color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))

```

The average number of adult and pediatric hospital admissions peaked between September and November in 2021 and January and Feburary in 2022.

####Overall Trend by State
```{r}
merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  drop_na%>%
  group_by(state)%>%
   mutate(avg_admission= mean(as.numeric(admission))) %>% 
   ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_admission)
  ) %>% 
 plot_ly(
      y = ~avg_admission, x = ~state, color = ~state,
      type = "bar", colors = "viridis") %>% 
  layout(
    xaxis = list(title = "State"),
    yaxis = list(title = "Number of Hospital Admissions")
)

state.x77

merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  drop_na%>%
  group_by(state)%>%
   mutate(avg_admission= mean(as.numeric(admission))) %>% 
   ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_admission)
  ) %>% 
 ggplot(aes(x = state, y = avg_admission)) +
  geom_point() +
  labs(title = "Average Number of Hospital Admissions with Confirmed Influenza", x = "date", y = "Number of Hospital Admissions")+
  theme(plot.title=element_text(face="bold", size=12, color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))
```
The five states with the highest number of average hospital admissions for influenza are Texas, Florida, California, New York, Ohio. The states with the lowest number of average hospital admissions are Vermont, Arkansas, Rhode Island, District of Columbia, and Wyoming.



###Trends for Flu-like Symptoms in the Past 7 Days (weighted)
```{r}
merged%>%
  drop_na%>%
  group_by(date)%>%
  summarize(avg_symptom=mean(as.numeric(symptom)))%>%
  ggplot(aes(x = date, y = avg_symptom)) +
  geom_line()+
  labs(title = "Average Percentage of Reporting Influenza-like Symptoms", x = "Date", y = "Percentage of Influenza-like Symptoms")+
   theme(plot.title=element_text(face="bold", size=12, color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))
```

####Overall Trend by State
```{r}
merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  drop_na%>%
  group_by(state)%>%
   mutate(avg_symptom= mean(as.numeric(symptom))) %>% 
   ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_symptom)
  ) %>% 
 plot_ly(
      y = ~avg_symptom, x = ~state, color = ~state,
      type = "bar", colors = "viridis") %>% 
  layout(
    xaxis = list(title = "State"),
    yaxis = list(title = "Percentage of Flu-Like Symptoms")
)

state.x77

merged %>% 
  mutate_if(is.character, str_to_upper)%>%
  drop_na%>%
  group_by(state)%>%
   mutate(avg_symptom= mean(as.numeric(symptom))) %>% 
   ungroup()%>%
   mutate(
    state = factor(state),
    state = fct_reorder(state, avg_symptom)
  ) %>% 
 ggplot(aes(x = state, y = avg_symptom)) +
  geom_point() +
  labs(title = "Average Percentage of People Reporting Flu-Like Symptoms", x = "date", y = "Percentage of Flu-Like Symptoms")+
  theme(plot.title=element_text(face="bold", size=12, color="blue"))+
  theme(axis.text.x = element_text(angle=80, hjust=1))
```





