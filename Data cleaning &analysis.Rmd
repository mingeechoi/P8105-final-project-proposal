---
title: "Data Cleaning & Analysis"
author: "Junyu QI"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
library(tidyverse)
```

## Create Final Dataset - Longitudinal

```{r}
e_mask=
read_csv("./Data/People_wearing_masks.csv") %>%
  janitor:: clean_names()  %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_mask = mean(value))

view(e_mask)

o_admission =
read_csv("./Data/Confirmed_admission.csv") %>%
  janitor:: clean_names() %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_admission = mean(value))

view(o_admission)  

e_mask <-
read_csv("./Data/People_wearing_masks.csv") %>%
  janitor::clean_names()  %>%
  select (geo_value, time_value, value, sample_size, stderr) %>%
  rename(maskwearing=value, maskwearing_stderr=stderr, maskwearing_samplesize=sample_size,
         state=geo_value, date=time_value)

o_symptoms <-
read_csv("./Data/Flu_like_symptoms.csv") %>%
  janitor:: clean_names()  %>%
  select(geo_value, time_value, value, sample_size, stderr) %>%
  rename(symptom=value, symptoms_stderr=stderr, symptom_samplesize=sample_size,state=geo_value, date=time_value)

o_admission <-
read_csv("./Data/influenza_admissions.csv") %>%
  janitor:: clean_names() %>%
  select(-x1) %>%
  select (geo_value, time_value, value) %>%
  rename(admission=value, state=geo_value, date=time_value) 

o_finances <-
  read_csv("data/worried_finances.csv") %>%
  janitor::clean_names() %>%
  select(-x1) %>%
  select(geo_value, time_value, value, sample_size, stderr) %>%
  rename(symptom = value, finances_stderr = stderr, finances_samplesize = sample_size,     state=geo_value, date=time_value) %>%
  group_by(state) %>%
  summarize(mean_symptom = mean(symptom))
  
  
avg_depression <- read.csv("Data/depression.csv") %>% 
  janitor:: clean_names()  %>% select (geo_value, time_value, value, sample_size, stderr) %>% 
  group_by(geo_value) %>% summarise(avg_depression = mean(value))

long_depression <- read.csv("Data/depression.csv") %>% 
  janitor:: clean_names()  %>% select (geo_value, time_value, value) %>% rename(depression=value) 
  

merge1 <-
  inner_join(
  x = e_mask,
  y = o_admission,
  by = c("state", "date"),
  all.x = TRUE) 

merge2 <-
  inner_join(
    x = o_symptoms,
    y = merge1,
    by = c("state", "date"),
    all.x = TRUE)
  
merge3 <-
  inner_join(
  x = o_finances,
  y = merge2,
  by = c("state", "date"),
  all.x = TRUE)

write.csv(merge3,"merged.csv" )

```

## Create Final Dataset - Annual Average


