---
title: "Data Cleaning & Analysis"
author: "Junyu QI"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
library(tidyverse)
```

## Create Final Dataset - Longitudinal

```{r}
e_mask <-
read_csv("./Data/People_wearing_masks.csv") %>%
  janitor::clean_names()  %>%
  select (geo_value, time_value, value, sample_size, stderr) %>%
  rename(maskwearing=value, maskwearing_stderr=stderr, maskwearing_samplesize=sample_size,
         state=geo_value, date=time_value)

e_mask <-
read_csv("./Data/People_wearing_masks.csv") %>%
  janitor::clean_names()  %>%
  select (geo_value, time_value, value, sample_size, stderr) %>%
  rename(maskwearing=value, maskwearing_stderr=stderr, maskwearing_samplesize=sample_size,
         state=geo_value, date=time_value)

o_symptoms <-
read_csv("./Data/Flu_like_symptoms.csv") %>%
  janitor:: clean_names()  %>%
  select(geo_value, time_value, value, sample_size, stderr) %>%
  rename(symptom=value, symptoms_stderr=stderr, symptom_samplesize=sample_size,state=geo_value, date=time_value)

o_admission <-
read_csv("./Data/influenza_admissions.csv") %>%
  janitor:: clean_names() %>%
  select(-x1) %>%
  select (geo_value, time_value, value) %>%
  rename(admission=value, state=geo_value, date=time_value) 

o_finances <-
  read_csv("data/worried_finances.csv") %>%
  janitor::clean_names() %>%
  select(-x1) %>%
  select(geo_value, time_value, value, sample_size, stderr) %>%
  rename(symptom = value, finances_stderr = stderr, finances_samplesize = sample_size,     state=geo_value, date=time_value)

o_depression <- 
  read.csv("Data/depression.csv") %>% 
  janitor:: clean_names() %>% 
  select (geo_value, time_value, value) %>% 
  rename(depression=value) 
  

merge1 <-
  inner_join(
  x = e_mask,
  y = o_admission,
  by = c("state", "date"),
  all.x = TRUE) 

merge2 <-
  inner_join(
    x = o_symptoms,
    y = merge1,
    by = c("state", "date"),
    all.x = TRUE)
  
merge3 <-
  inner_join(
  x = o_finances,
  y = merge2,
  by = c("state", "date"),
  all.x = TRUE)

write.csv(merge3,"merged.csv" )

```

## Create Final Dataset - Annual Average

```{r}
e_mask_avg <- 
read_csv("./Data/People_wearing_masks.csv") %>%
  janitor:: clean_names()  %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_mask = mean(value))

o_admission_avg <-
read_csv("./Data/Confirmed_admission.csv") %>%
  janitor:: clean_names() %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_admission = mean(value))

o_symptoms_avg <-
read_csv("./Data/Flu_like_symptoms.csv") %>%
  janitor:: clean_names() %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_symptom = mean(value))

o_finances_avg <-
  read_csv("data/worried_finances.csv") %>%
  janitor:: clean_names() %>%
  select (geo_value, time_value, value) %>%
  group_by(geo_value) %>%
  summarize(avg_finances = mean(value))

  
o_depression_avg <- read.csv("Data/depression.csv") %>% 
  janitor:: clean_names()  %>% 
  select (geo_value, time_value, value) %>% 
  group_by(geo_value) %>% 
  summarize(avg_depression = mean(value))

merge1_avg <-
  inner_join(
  x = e_mask_avg,
  y = o_admission_avg,
  by = c("geo_value"),
  all.x = TRUE) 

merge2_avg <-
  inner_join(
  x = merge1_avg,
  y = o_symptoms_avg,
  by = c("geo_value"),
  all.x = TRUE) 

merge3_avg <-
  inner_join(
  x = merge2_avg,
  y = o_finances_avg,
  by = c("geo_value"),
  all.x = TRUE) 

merge4_avg <-
  inner_join(
  x = merge3_avg,
  y = o_depression_avg,
  by = c("geo_value"),
  all.x = TRUE) %>%
  mutate(state = toupper(geo_value)) %>%
  relocate(state, .before = avg_mask) %>%
  select(-geo_value)



```

